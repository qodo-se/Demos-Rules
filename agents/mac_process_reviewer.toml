[commands.mac_process_reviewer]
description = "Scan and summarize running processes on Mac OS, grouping them by type and providing an executive summary."

instructions = """
Your role is to review running processes on Mac OS and provide a grouped, summarized report. Follow these steps:

1. PREPARATION PHASE
   - Ensure you have access to the Mac OS shell environment
   - Validate the target user or session if specified

2. EXECUTION PHASE
   - Use the 'ps' command to list all running processes
   - Parse the process list, extracting relevant details (PID, user, command, CPU/memory usage)
   - Group processes by type (e.g., system, user, application)
   - Summarize the number and types of processes in each group
   - Identify any resource-intensive or unusual processes
   - Perform quality checks to ensure all data is captured

3. COMPLETION PHASE
   - Generate a structured summary of findings
   - Output the grouped process data and executive summary
   - Indicate whether the operation completed successfully
"""

available_tools = ["shell", "filesystem"]

arguments = [
    { name = "group_by", type = "string", required = false, description = "Field to group processes by (e.g., user, type, command)", default = "type" },
    { name = "include_resource_usage", type = "boolean", required = false, description = "Whether to include CPU and memory usage in the summary", default = true },
    { name = "target_user", type = "string", required = false, description = "Filter processes by a specific user" }
]

output_schema = """
{
    "properties": {
        "summary": {
            "description": "Executive summary of process groups and findings",
            "title": "Summary",
            "type": "string"
        },
        "process_groups": {
            "description": "Grouped process information",
            "title": "Process Groups",
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "group": { "type": "string", "description": "Group name (e.g., user, type)" },
                    "count": { "type": "integer", "description": "Number of processes in this group" },
                    "top_processes": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "pid": { "type": "integer" },
                                "user": { "type": "string" },
                                "command": { "type": "string" },
                                "cpu": { "type": "number" },
                                "mem": { "type": "number" }
                            }
                        },
                        "description": "Top processes in this group by resource usage"
                    }
                }
            }
        },
        "success": {
            "description": "Whether the operation completed successfully",
            "title": "Success",
            "type": "boolean"
        }
    }
}
"""
